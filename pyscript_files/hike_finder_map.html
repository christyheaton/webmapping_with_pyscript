<!DOCTYPE html>
<html>
<head>
    <title>Hike Suggester</title>
    <meta charset="UTF-8">
    <script defer src="https://pyscript.net/releases/2023.05.1/pyscript.js"></script>
    <link rel="stylesheet" href="https://pyscript.net/releases/2023.05.1/pyscript.css" />

</head>
<body>
  <div id="folium"></div>
  <py-config>
    packages = ["folium", "pandas", "geopandas"]
  </py-config>
<py-script output="map">
  import folium
  import pandas as pd
  import geopandas as gpd
  from pyodide.http import open_url

  url = "https://raw.githubusercontent.com/christyheaton/webmapping_with_pyscript/main/Data/2021-04-25_wta_hike_data.csv"
  hike_data = pd.read_csv(open_url(url))
  
  hike_data = hike_data.dropna(subset=['LATITUDE', 'LONGITUDE', 'DISTANCE'])

  hike_data = hike_data[(hike_data["DISTANCE"] >= 8) & (hike_data["DISTANCE"] <= 20) & (hike_data["DIST_TYPE"] == "roundtrip")].reset_index(drop=True)
  hike_data = hike_data[hike_data["RATING"] >= 4].reset_index(drop=True)

  hikes_gdf = gpd.GeoDataFrame(hike_data, geometry=gpd.points_from_xy(hike_data.LONGITUDE, hike_data.LATITUDE))
  hikes_gdf = hikes_gdf.set_crs("epsg:4326")

  sample_hikes = hikes_gdf.sample(n=5)

  m = folium.Map(location=[47.6, -122.3], zoom_start=7)
  for index, row in sample_hikes.iterrows():
    popup_text = "Name: {}<br> Distance: {}"
    popup_text = popup_text.format(row["TITLE"], row["DISTANCE"])
    folium.CircleMarker(location= (row["geometry"].y, row["geometry"].x), color="orange", radius=10, popup=popup_text, fill=True).add_to(m)

  display(m, target="folium")
</py-script>
</body>
</html>